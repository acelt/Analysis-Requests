---
title: "Ecological Site Summary Tool"
subtitle: "Interactive Reporting Using Assessment, Inventory, and Monitoring (AIM) and Landscape Monitoring Framework (LMF)"
author: "A Reporting Tool by USDA-ARS Jornada" 
date: " "
output:
  html_document:
    theme: cosmo
---
```{r echo = FALSE}
htmltools::img(src = knitr::image_uri("jornadalogo.png"), 
               alt = 'logo', 
               style = 'position:absolute; top:0; right:0; padding:10px;')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE , message = FALSE , warning = FALSE)

#Load required packages

#The following Packages are required to connect to the AIM Pub Database
library(RODBC)
library(dplyr)

#The remaining packages are required to generate the ESS Report

library(tidyverse)
library(knitr)
library(kableExtra)
library(leaflet)
library(patternplot)
library(magrittr)
library(rgdal)
library(RColorBrewer)
library(units)
library(sp)
library(sf)
library(rworldmap)
library(rworldxtra)
library(raster)
library(plotly)


```

![Photo by Patrick Alexander](BannerPhoto.jpg)

# 1. Introduction {.tabset .tabset-fade .tabset-pills}
##
## About Ecological Sites

The U.S. Department of Agriculture Natural Resources Conservation Service (NRCS) defines ecological sites as "a distinctive kind of land with specific physical characteristics that differs from other kinds of land in its ability to produce a distinctive kind and amount of vegetation" ([USDAâ€“NRCS, 2006](https://www.nrcs.usda.gov/wps/portal/nrcs/detail/national/landuse/rangepasture/?cid=stelprdb1068392)). Ecological sites determine not only the ecological potential of a site, but also how a site can respond to natural disturbance and management actions. Ecological sites have been delineated for many areas using physical and biotic features and are linked to soil map units. Soils, climate, hydrology, geology, physiographic features, plants species occurrences, plant community composition, annual biomass production, and plant-wildlife interactions all contribute to the proerties of ecological sites.  Ecological Site Descriptions (ESDs) describe the underlying factors associated with a specific ecological site, as well as different ecological states within a given site based on factors such as grazing, fire, drought, and other management actions. For an example of an ESD, see [EDIT Jornada](https://edit.jornada.nmsu.edu/page?content=class-description&catalog=3&spatial=84&class=5802#top-bookmark).

## Ecological Site Summary

Using ecological monitoring data, the overall status of an Ecological Site can be summarized into an Ecological Site Summary (ESS). At the site level, ecological site summaries generated from monitoring data can tell us about the condition and health of ecological sites based on indicators such as cover by structure and functional group, species dominance, species occurrences, canopy gap measurements, and soil stability measurements. These indicators can help inform the user of the ecological state of a given plot or overall site (i.e. shrubland state vs. grassland state). Identifying the ecological state allows us to not only determine the degree of departure from the corresponding reference ecological states, but also to inform management and restoration actions accordingly by determining the best pathway to a less degraded state. For more on state and transition models (STMs), see see [Bestelmeyer et al., 2017](https://link.springer.com/content/pdf/10.1007%2F978-3-319-46709-2_9.pdf).
A major data source for developing these summaries is the Assessment, Inventory, and Monitoring (AIM) Program along with the Landscape Monitoring Framework (LMF). AIM and LMF include almost 25,000 plots throughout the western United States (*see* [AIM Data Portal](https://aim.landscapetoolbox.org/data-management-project-evaluation/databases/)) stored in the Terrestrial AIM Database (TerrADat). Data garnered from AIM and LMF plots is both generalizable and scalable and thus applicable to management decisions across multiple disciplines at both local and national levels.

## ESS Tool

An Ecological Site Summary (ESS) tool has been developed to help users visualize the overall status of their region of interest within a specific ecological site, or across an ecological site group. This information can be summarized within a given administrative state or across political boundaries for landscape scale analysis. Ecological site summaries are generated using an R Markdown script with an interactive HTML output in which users can query summary tables, download full or filtered summary tables to view in Excel, explore interactive figures, and download static figures for their own use.

This report is an automated process and can be continually updated as new data becomes available each year or as lines of inquiry shift. This ESS information can be included in decision making processes for BLM managers, as it can help inform land use plans, grazing permit renewals, shrub or invasive species treatments, and/or seed menu development for ecological restoration and reclamation.

## Using the ESS Tool {.tabset .tabset-fade .tabset-pills}

This report generates many tables and figures that can be queried, filtered, and downloaded to meet your management and reporting needs. Multiple output types are used to meet multiple needs, so select the most relevant and useful output. 

###
### I want this report generated for me

This report is generated in RMarkdown. If you have R limitations and would prefer the report to be generated for you, use this [template](https://github.com/R-Burke/EcologicalSiteSummaries/blob/master/ESS_Template.xlsx) to request that Jornada run the report.

### I want to group by other features for a custom report

In cases where ESDs are not developed, grouping AIM data by other features can provide similar information, and potentially lead to the development of new ESDs. For this purpose, it may be informative to group data by features such as watershed units, soil map units, or biophysical settings. Spatial groupings may also be beneficial if you want to compare data that's in the same ecological site but across multiple management units such as grazing allotments, pastures, prescribed burn areas, etc. Grouping indicators by other spatial attributes is available in a customized report on page two of this [template](https://github.com/R-Burke/EcologicalSiteSummaries/blob/master/ESS_Template.xlsx).

### I want to run this report myself {.tabset .tabset-fade .tabset-pills}

####
#### Getting started {.tabset .tabset-fade .tabset-pills}

#####
##### Download the data

Download the ESS_Tool folder from the AIM Sharepoint that contains the ESS_Tool project (ESS_Tool.Rproj), RMarkdown script (ESS_Tool.Rmd), report rending script (RenderReport.R) and supporting documents (BannerPhoto.jpg, Boxplot_text.png, and jornadalogo.png, and defaults folder containing EDIT_public_ecological_site_list.csv). Unzip the folder into your local drive documents (i.e. *C:/Users/*JSmith/Documents/). Open the ESS_Tool.Rproj using RStudio. From there, go to file, open file, and open RenderReport.R. 

##### Set your defaults and run the report
In RenderReport.R, set your EcologicalSiteId, path to the TerrADat geodatabase (NULL if you are working within the BLM network, the script will default to AIMPub), your working folder (the location on your local drive where you placed the ESS_Tool folder), your library path (*note: make sure your library is on your local drive, not the BLM server, or you will not be able to render this report- i.e. C:/Users/JSmith/Documents/R/win-library/3.6*). Set BLM to TRUE (if you are working within BLM network/VPN) or FALSE (if you are accessing TerrADat externally). Set your state (2 letter abbreviation, all caps). 

Now run every line in the RenderReport.R. The report should only take several minutes, but may take longer if accessing internal data from VPN. 
The output HTML document will be saved in the project folder. View the document in Google Chrome or Firefox (*some features will be disabled in Internet Explorer*). You need to be connected to the internet to run the report, but you can view it without internet (*note that the basemap feature will be disabled offline*).

```{r install, echo = FALSE, include = FALSE}
#Set the path to your R library (make sure it's on local folder not network drive)
LibraryPath <- LibraryPath
.libPaths(LibraryPath)
install.packages("devtools")
library(devtools)
library(ggplot2)

BLM <- BLM
State <- State

#What shapefile attributes do you want included in the summary?
#Below are BLM allotment naming conventions 
#attribute_title <- c("ALLOT_NAME", "ALLOT_NO")

if(BLM){
#Archived RODBC
packageurl <- "https://cran.r-project.org/src/contrib/Archive/RODBC/RODBC_1.3-15.tar.gz"

if(!require(RODBC)){
install.packages(packageurl, repos=NULL, type="source")
library(RODBC)}
}
devtools::install_github("R-Burke/SiteSummaryTool")
library(SiteSummaryTool)
if(!require(tidyr)){
install.packages("tidyr")}
library(tidyr)
if(!require(dplyr)){
install.packages("dplyr")
}
library(dplyr)
```

```{r set EcologicalSiteId, echo = FALSE, include = FALSE}

EcologicalSiteId <- EcologicalSiteId

#Set the path to TerrADat (this will be NULL if working within BLM network)
#If working within BLM network, TerrADat_Path = NULL (this tool will direct to AIMPub)
#BLM <- TRUE if internal (on VPN). BLM <- FALSE if external
#EDIT_List_Path <- path to this repository
EDIT_List_Path <- paste0(WorkingFolder, "/", "defaults/", sep = "")

if(!BLM){
TerrADat_Path <- TerrADat_Path
}

if(BLM){
TerrADat_Path <- NULL
conn <- RODBC::odbcConnect("ilmocAIMPub")
TerrADat <- RODBC::sqlQuery(conn, 'SELECT * FROM ilmocAIMPub.ilmocAIMPubDBO.TerrADat;')
LMF <- RODBC::sqlQuery(conn, 'SELECT * FROM ilmocAIMPub.ilmocAIMPubDBO.LMF;')
TerrADatSpecies <- RODBC::sqlQuery(conn, 'SELECT * FROM ilmocAIMPub.ilmocAIMPubDBO.TerrADatSpeciesIndicators;')
LMFSpecies <- RODBC::sqlQuery(conn, 'SELECT * FROM ilmocAIMPub.ilmocAIMPubDBO.LMFSpeciesIndicators;')
SpeciesList <- RODBC::sqlQuery(conn, 'SELECT * FROM ilmocAIMPub.ilmocAIMPubDBO.tblStateSpecies;')
}

# wHEN DOING AN ANALYSIS WITH HMAS - WE WANT TO SELECT THE HMA SHAPEFILE FROM THE NETWORK AND SELECT THE POLYGON OF INTEREST
if(HMA){
  #Adding WHB polygon from EGIS
  shapefile_path <-  "C:\\Users\\alaurencetraynor\\Documents\\2021\\Analysis\\CO\\WHFO\\Piceance East Douglas HMA\\Piceance East Douglas HMA\\Piceance East Douglas HMA.gdb"
  shapefile_name <- "whb_hma_poly"
  attribute_title <- "HMA_NAME"
  atribute_name <- hma_name #Will need to select the layer based on this
}
```


```{r load data, echo = FALSE, include = FALSE}
##The state species list table should also live in this geodatabase
# We'll only read in the full terradat if it is not already 
# (i.e. if you're running this multiple times)

if(Groups){
  TerrADat[setdiff(names(LMF) , names(TerrADat))] <- NA
  LMF[setdiff(names(TerrADat), names(LMF))] <- NA
  TDat_LMF <- rbind(TerrADat, LMF)
  
  TDat_LMF <- merge(x = TDat_LMF,
                    y = groups[,c("PrimaryKey",paste0(group_name))],
                    by = "PrimaryKey")
  TDat_LMF$EcologicalSiteId <- TDat_LMF$ES_Name_Verified
  EcologicalSiteId <- unique(TDat_LMF$ES_Name_Verified)
  #Pull out year for futur
  TDat_LMF$DateVisited <- sub("^(\\d{4}).*$", "\\1", TDat_LMF$DateVisited)
  TDat_LMF <- TDat_LMF %>% dplyr::rename(Year = DateVisited)
}else{
   TDat_LMF <- Combine_AIM_LMF(TerrADat_Path = TerrADat_Path, 
                            EDIT_List_Path = EDIT_List_Path, Internal = BLM)
}

TDat_LMF_Attributed <- AttributePlots(TDat_LMF = TDat_LMF, shapefile_name = shapefile_name,
               shapefile_path = shapefile_path, attribute_title = attribute_title)

Attributed_Pks <- TDat_LMF_Attributed %>% dplyr::select(PrimaryKey, all_of(attribute_title))

EcoSitePlots <- SubsetEcologicalSite(TDat_LMF, EcologicalSiteId)
# Since Anna provided a separate list of ecosites, we'll use that

EcoSitePlots_Attributed <- merge(EcoSitePlots, Attributed_Pks, by = "PrimaryKey", all = TRUE)

Species_Indicator <- Combine_AIM_LMF_Species(TerrADat_Path = TerrADat_Path,                                              Internal = BLM)

Species_plots_ecosite <- SubsetEcologicalSite_Species(EcoSitePlots, Species_Indicator)

SpeciesList <- ReadSpeciesList(TerrADat_Path = TerrADat_Path, Internal = BLM)

```

# 2. Interpreting report figures {.tabset .tabset-fade .tabset-pills}

This report uses boxplots to summarize cover values into quartiles while keeping outliers visible. The figures in this report are interactive within the tool. Hovering over the dots on the plot will give you the Plot ID of the plot from which the measure was obtained, as well as the individual species from which the measurement was obtained if applicable. Hovering over the boxplot will give you quartile values. The interactive figures can be downloaded as static figures to incorporate into reports.
*The following image explains how to interpret a boxplot.*

##
## Boxplot

![ Intepretting a Box Plot. Modified from: https://www.wellbeingatschool.org.nz/information-sheet/understanding-and-interpreting-box-plots (accessed 22 Aug2019)](boxplot_text.png)



# 3. Where are the data coming from? {.tabset .tabset-fade .tabset-pills}
##
## Plot Map \

Below is a map of  plots surveyed to date.
Plots in our ecological site of interest are highlighted in red. \

```{r, echo = FALSE , include = FALSE}
# making a few changes to the make map function
MakeMap <- function(EcologicalSiteId, TDat_LMF, EcoSitePlots){

  ##Caption to use in your tables and plots
  Caption <- paste0("Cover Summaries for Ecological Site" , EcologicalSiteId)

  #Clean up
  TDat_LMF <- TDat_LMF %>%
        dplyr::arrange(EcologicalSiteId) %>%
            dplyr::filter(Latitude_NAD83 > 0)

  # List of ecological sites for legend
  EcoSiteList <- unique(TDat_LMF$EcologicalSiteId)

  #Set color palettes
  Pal_EcoSite <- leaflet::colorFactor(palette = 'YlOrRd' , domain = TDat_LMF$es_name)
  Pal_Date <- leaflet::colorFactor(palette = 'Greys' , domain = TDat_LMF$Year)
  Pal_EcoSiteID <- leaflet::colorFactor(palette = "Accent" , domain = EcologicalSiteId)
  EcoSite_All <- TDat_LMF$es_name
  Year <- TDat_LMF$Year

  Map <- leaflet::leaflet(height = 650 , width = 650)

  #Convert vector to string to use in caption
  EcoSiteCaption <- toString(EcologicalSiteId)

  Map <- leaflet::addTiles(Map) %>% leaflet::addCircleMarkers(lng = ~Longitude_NAD83 , lat = ~Latitude_NAD83 , radius = 3 ,
                                            popup = paste("Ecological Site: " , TDat_LMF$es_name,
                                                          "Ecolgical Site Id: " , TDat_LMF$EcologicalSiteId,
                                                          sep = "<br>") ,
                                            color = ~Pal_Date(Year) ,
                                            fillOpacity = .5 , group = Year ,
                                            data = TDat_LMF) %>%
    leaflet::addCircleMarkers(lng = ~Longitude_NAD83 , lat = ~Latitude_NAD83 ,
                     radius = 3 ,
                     fillOpacity = 0.5 ,
                     popup = paste("Ecological Site: " ,EcoSitePlots$es_name ,
                                   "Ecological Site Id: " , EcoSitePlots$EcologicalSiteId ,
                                   sep = "<br>") ,
                     color = ~Pal_EcoSiteID(EcologicalSiteId) , group = EcologicalSiteId ,
                     data = EcoSitePlots) %>%
    leaflet::addLayersControl(overlayGroups = c(EcologicalSiteId , Year) ,
                     options = leaflet::layersControlOptions(collapsed = TRUE)) %>%
    leaflet::addLegend(pal = Pal_Date , values = TDat_LMF$Year , opacity = 1 , group = Year) %>%
    leaflet::addLegend(pal = Pal_EcoSiteID , values = EcologicalSiteId , opacity = 1 , group = EcologicalSiteId)

  return(Map)

}
```

```{r map , echo = FALSE , include = TRUE}

MakeMap(EcologicalSiteId, TDat_LMF, EcoSitePlots)
                                         
```


## Some metadata {.tabset .tabset-fade .tabset-pills}
###
### Plots Per Year, All Ecological Sites (Nationally)

```{r plots figure , echo = FALSE , include = TRUE , fig.height = 3 , fig.width = 8 , fig.cap = "Total Plots Per Year, AIM & LMF"}

PlotMetadata(dataframe = TDat_LMF)

```

###
### Plots Per Year, Your Ecological Site(s)

```{r plots figure 2 , echo = FALSE , include = TRUE , fig.height = 3 , fig.width = 8, fig.cap = "Plots Per Year in Ecological Site, AIM & LMF"}

PlotMetadata(dataframe = EcoSitePlots)

```

# 4. Species Cover Summaries {.tabset .tabset-fade .tabset-pills}

Percent cover summaries use data from Line-point intercept (LPI) method to determine average cover of individual species, as well as summaries by structure and functional group cover, noxious versus non-noxious cover,  woody vs. non-woody cover, and cover by Sage-Grouse group. From the AIM data, we can make some simple figures showing cover values. These figures, along with the summary tables, can quickly be incorporated into any documents where this data is used (i.e. NEPA documents for grazing permit renewals, shrub treatments, etc).

##

## Figures {.tabset .tabset-fade .tabset-pills}

###

### Cover by Functional Group {.tabset .tabset-fade .tabset-pills}

####

#### Graminoid {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

```{r, echo=FALSE,include=FALSE}
# need to alter summary function here to exclude allot name
# Currently hardcoded for allotments in BLM naming convention
SageGrouseSummaries_WithAttributes_alt <- function(EcoSitePlots_Attributed, Species_plots_ecosite,
                                Interactive, SummaryVar, Attributed_Pks){

  SageGrouseStates <- c("CO", "UT", "NV", "CA", "WY", "MT", "ID", "OR", "WA", "ND", "SD")

  #Prep
  SpeciesList <- SpeciesList %>% dplyr::select(Species, ScientificName, CommonName,
                                               Family, SpeciesState,
                                               SynonymOf, UpdatedSpeciesCode) %>%
    dplyr::mutate(link = paste("https://plants.sc.egov.usda.gov/core/profile?symbol=", Species, sep = ""))

#Merge with species list so we can hover for scientific name
Species_plots_ecosite_attributed <- merge(Species_plots_ecosite, Attributed_Pks, by = "PrimaryKey", all = TRUE) %>% 
                                    unique() 

EcoSitePlots_Attributed <- merge(EcoSitePlots, Attributed_Pks, by = "PrimaryKey", all = TRUE)

Attribute_Fill <- scales::seq_gradient_pal("#009966", "#E69F00", "Lab")(seq(0,1, length.out = length(unique(Species_plots_ecosite_attributed[[attribute_title]]))))


  Species_plots_ecosite_attributed <- merge(Species_plots_ecosite_attributed , SpeciesList , by = c("Species" , "SpeciesState")) %>%
    dplyr::select(Species, ScientificName, CommonName, PrimaryKey,
                  PlotID,  AH_SpeciesCover,
                  AH_SpeciesCover_n, Hgt_Species_Avg,
                  Hgt_Species_Avg_n, GrowthHabit, GrowthHabitSub, Duration,
                  Noxious, SG_Group, link, UQ(attribute_title)) %>%
                  dplyr::mutate_if(is.numeric, round , digits = 2) %>%
                  filter(!is.na(SG_Group)) # only filter this for the sage-grouse plots

if(!EcoSitePlots_Attributed$State %in% SageGrouseStates){SG_Plots <- paste0("No type I Sage-Grouse Habitat in ", State)}

  else{

     if(SummaryVar == "PreferredForb"){
     PrefForb <- Species_plots_ecosite_attributed %>%
                                  filter(!is.na(SG_Group)) %>%
                                  mutate(PreferredForb = (SG_Group == "PreferredForb")) %>%
                                  subset(PreferredForb == TRUE) %>%
                                  subset(AH_SpeciesCover > 0.0000)

  if(Interactive){
      SG_Plots <-  if (nrow(PrefForb) < 1){SG_Plots <- NULL}
      else{
      ggplot(PrefForb , aes(x = Species , y = AH_SpeciesCover,
                                              text = paste("Primary Key: " , PrimaryKey ,
                                                           "Plot ID: " , PlotID ,
                                                           "Species: " , ScientificName ,
                                                           "Code: " , Species ,
                                                           "Sage-Grouse Group: " , SG_Group ,
                                                           "Duration: " , Duration ,
                                                           "Percent Cover: " , AH_SpeciesCover ,
                                                           "Noxious: " , Noxious , 
                                                           "Attribute: ", UQ(attribute_title), 
                                                            sep = "<br>"))) +
                                            geom_boxplot(width = .6 , outlier.shape = NA) +
                                            geom_jitter(width = .15 , size = 2 , shape = 21) +
                                            scale_y_continuous(limits = c(0 , 100)) +
                                            theme_light() +
                                            labs(y = "Percent Cover") +
                                            ggtitle(paste("Percent Cover, Preferred Forbs: " , toString(EcologicalSiteId))) +
                                            theme(axis.title.y = element_blank() ,
                                            axis.title.x = element_blank(),
                                            axis.text.y = element_blank(),
                                            axis.ticks.y = element_blank(),
                                            panel.grid.major.y = element_blank()) +
                                            facet_grid(rows = vars(Species), drop = TRUE,
                                                       scales = "free") +
                                            coord_flip()
    }}

    if(!Interactive){

    #add this if statement to every plot. it will return NULL if the dataframe is empty

    SG_Plots <- if (nrow(PrefForb) < 1) {SG_Plots <- NULL} else{
      ggplot(PrefForb , aes(x = Species , y = AH_SpeciesCover)) +
                        geom_boxplot(width = .6 , outlier.shape = NA) +
                        geom_jitter(width = .15 , size = 2, aes(color = UQ(attribute_title), shape = Noxious)) +
                        scale_color_manual(values = Attribute_Fill, na.value="#000000") +
                        scale_y_continuous(limits = c(0 , 100)) +
                        theme_light() +
                        labs(y = "Percent Cover") +
                        ggtitle(paste("Percent Cover, Preferred Forbs: " ,
                                      toString(EcologicalSiteId))) +
                        theme(panel.grid.major.y = element_blank()) +
                        coord_flip()
}}

return(SG_Plots)

}


if(SummaryVar == "SageGrouseGroup"){

##SG GROUP

    if(Interactive){
    SG_Plots <- ggplot(Species_plots_ecosite_attributed, aes(x = SG_Group , y = AH_SpeciesCover,
                                               text = paste("Primary Key: " , PrimaryKey ,
                                               "Plot ID: " , PlotID , "Species: " ,
                                                ScientificName , "Code: " , Species ,
                                                "Sage-Grouse Group: " , SG_Group ,
                                                "Percent Cover: " , AH_SpeciesCover ,
                                                "Noxious: " , Noxious , 
                                                "Attribute: ", UQ(attribute_title), 
                                                 sep = "<br>"))) +
                    geom_boxplot(width = .6 , outlier.shape = NA) +
                    geom_jitter(width = .15 , size = 2 , shape = 21) +
                    scale_y_continuous(limits = c(0 , 100)) +
                    theme_light() +
                    ggtitle(paste("Percent Cover, Sage-Grouse Group: " ,
                                  toString(EcologicalSiteId))) +
                    theme(axis.title.y = element_blank() , axis.title.x = element_blank(),
                          axis.text.y = element_blank(), axis.ticks.y = element_blank(),
                          panel.grid.major.y = element_blank()) +
                          facet_grid(rows = vars(SG_Group), drop = TRUE, scales = "free")+
                    coord_flip() }

  if(!Interactive){

    SG_Plots <- ggplot(Species_plots_ecosite_attributed , aes(x = SG_Group , y = AH_SpeciesCover)) +
                            geom_boxplot(width = .6 , outlier.shape = NA) +
                            geom_jitter(width = .15 , size = 2, aes(color = UQ(attribute_title), shape = Noxious)) +
                            scale_y_continuous(limits = c(0 , 100)) +
                            theme_light() +
                            labs(y = "Percent Cover") +
                            scale_color_manual(values = Attribute_Fill, na.value="#000000") +
                            ggtitle(paste("Percent Cover, Sage-Grouse Group: " ,
                                          toString(EcologicalSiteId))) +
                            theme(panel.grid.major.y = element_blank(),
                            axis.text.y = element_blank(), axis.title.y = element_blank()) +
                            facet_grid(rows = vars(SG_Group) ,
                            switch = "y" ,
                            scales = "free" ,
                            drop = TRUE) +
                            coord_flip()}

    return(SG_Plots)

}}

if(SummaryVar == "Sagebrush"){

SageBrushCover <- EcoSitePlots_Attributed %>% dplyr::select(PlotID , PrimaryKey ,
                                                 AH_SagebrushCover ,
                                                 AH_SagebrushCover_Live ,
                                                 AH_SagebrushCover_Dead, 
                                                 UQ(attribute_title)) %>%
                                    mutate_if(is.numeric, round , digits = 2) %>%
                gather(key = SageBrushCover ,
                       value = Percent , AH_SagebrushCover:AH_SagebrushCover_Dead)

if (nrow(SageBrushCover) < 1) {SG_Plots <- NULL} else{
    if(Interactive){
    SG_Plots <-
      ggplot(SageBrushCover, aes(x = SageBrushCover , y = Percent ,
                                       text = paste("Primary Key: " , PrimaryKey ,
                                                    "Plot ID: " , PlotID ,
                                                    "Percent Cover: " , Percent ,
                                                    "Attribute: ", UQ(attribute_title), 
                                                     sep = "<br>"))) +
                             geom_boxplot(width = .6 , outlier.shape = NA) +
                             geom_jitter(width = .15 , size = 2 , shape = 21) +
                             scale_y_continuous(limits = c(0 , 100)) +
                             theme_light() +
                             labs(y = "Percent Cover") +
                             ggtitle(paste("Percent Cover, Sagebrush: " ,
                                           toString(EcologicalSiteId))) +
                             theme(axis.title.y = element_blank() ,
                             axis.text.y = element_blank(),
                             axis.title.x = element_blank(),
                             axis.ticks.y = element_blank(),
                             panel.grid.major.y = element_blank()) +
                             facet_grid(rows = vars(SageBrushCover),
                                        scales = "free",  drop = TRUE) +
                            coord_flip()
    }

  if(!Interactive){
        SG_Plots <- ggplot(SageBrushCover , aes(x = SageBrushCover , y = Percent)) +
                    geom_boxplot(width = .6 , outlier.shape = NA) +
                    geom_jitter(width = .15 , size = 2, aes(color = UQ(attribute_title))) +
                    scale_y_continuous(limits = c(0 , 100)) +
                    theme_light() +
                    scale_color_manual(values = Attribute_Fill, na.value="#000000") +
                    labs(y = "Percent Cover", x = "Sagebrush cover") +
                    ggtitle(paste("Percent Cover, Sagebrush: " ,
                                   toString(EcologicalSiteId))) +
                    theme(panel.grid.major.y = element_blank(),
                          axis.text.y = element_blank()) +
                     facet_grid(rows = vars(SageBrushCover),
                                drop = TRUE, scales = "free") +
                     coord_flip()}

return(SG_Plots)

}}
}
```

# rewrite function for HMA
```{r}
SummaryFigures_WithAttributes_alt <- function(SpeciesList, Species_plots_ecosite, EcologicalSiteId, 
                                  SummaryVar, Interactive, Attributed_Pks, EcoSitePlots){

#Prep
  SpeciesList <- SpeciesList %>% dplyr::select(Species, ScientificName, CommonName,
                                               Family, SpeciesState,
                                               SynonymOf, UpdatedSpeciesCode) %>% 
                 dplyr::mutate(link = paste("https://plants.sc.egov.usda.gov/core/profile?symbol=", Species, sep = ""))

#Merge with species list so we can hover for scientific name
Species_plots_ecosite_attributed <- merge(Species_plots_ecosite, Attributed_Pks, by = "PrimaryKey", all = TRUE) %>% 
                                    unique() 

EcoSitePlots_Attributed <- merge(EcoSitePlots, Attributed_Pks, by = "PrimaryKey", all = TRUE)



#Unhardcode last 3 columns in selection
Species_plots_ecosite_attributed <- merge(Species_plots_ecosite_attributed , SpeciesList , by = c("Species" , "SpeciesState")) %>% 
                         dplyr::select(Species, ScientificName, CommonName, PrimaryKey, 
                                PlotID,  AH_SpeciesCover, 
                                AH_SpeciesCover_n, Hgt_Species_Avg, 
                                Hgt_Species_Avg_n, GrowthHabit, GrowthHabitSub, Duration, 
                                Noxious, SG_Group, link,UQ(attribute_title)) %>%
                         dplyr::mutate_if(is.numeric, round , digits = 2) 

#Get Noxious versus Non in Standard Format

Species_plots_ecosite_attributed$Noxious <- gsub("YES" , "Yes", Species_plots_ecosite_attributed$Noxious)
Species_plots_ecosite_attributed$Noxious <- gsub("NO", "No", Species_plots_ecosite_attributed$Noxious)

#Ignoring NAs- make disclosure as this may overestimate cover
#For summarizing across all plots
Species_cover_summary <- Species_plots_ecosite_attributed %>% filter(!is.na(AH_SpeciesCover)) %>% 
                         mutate(Tally = 1) %>%
                         group_by(Species , GrowthHabit , GrowthHabitSub , 
                                  Duration , Noxious , ScientificName , 
                                  CommonName , SG_Group, link) %>% 
                         summarize(AveragePercentCover = mean(AH_SpeciesCover) ,
                         StandardDeviation = sd(AH_SpeciesCover),
                         MinCover = min(AH_SpeciesCover) ,
                         MaxCover = max(AH_SpeciesCover) , n = sum(Tally)) %>%
                         mutate_if(is.numeric, round , digits = 2) %>%
                         dplyr::select(Species, ScientificName, 
                                       AveragePercentCover, StandardDeviation,
                                       MinCover, MaxCover, n, GrowthHabit, 
                                       GrowthHabitSub, Duration, 
                                       Noxious, CommonName, SG_Group, link)

##Setting color palette for plot
NoxNonPal_Fill <- c("grey75"  , "#D55E00")
NoxNonPal_Dot <- c("grey33" , "#993300")
## Setting color for attribute title
## FIgure out how to not hardcode ALLOT_NAME and instead use attribute_title
Attribute_Fill <- scales::seq_gradient_pal("#009966", "#E69F00", "Lab")(seq(0,1, length.out = length(unique(Species_plots_ecosite_attributed[[attribute_title]]))))

#Remove NAs for plotting
Species_plots_ecosite_attributed <- Species_plots_ecosite_attributed %>% filter(!is.na(AH_SpeciesCover))
  
if(SummaryVar == "GrowthHabitSub"){
if(Interactive){
  Plots <-  lapply(X = split(Species_plots_ecosite_attributed, Species_plots_ecosite_attributed[["GrowthHabitSub"]] , 
                                           drop = TRUE),
                                 
                                 FUN = function(Species_plots_ecosite_attributed){
                                 
                                   current_plot <- ggplot2::ggplot(Species_plots_ecosite_attributed , 
                                                          aes(x = GrowthHabitSub, 
                                                              y = AH_SpeciesCover, 
                                                              text = paste("Primary Key: " , PrimaryKey , 
                                                                           "Plot ID: " , PlotID , "Species: " , 
                                                                            ScientificName , "Code: " , Species , 
                                                                            "Percent Cover: " , AH_SpeciesCover , 
                                                                            "Noxious: " , Noxious , 
                                                                            "Allotment: ", UQ(attribute_title), 
                                                                             sep = "<br>"))) +
                                     geom_boxplot(width = .6 , outlier.shape = NA) +
                                     geom_jitter(width = .2 , size = 2 , shape = 21) +
                                     theme_light() +
                                     scale_y_continuous(limits = c(0 , 100))  +
                                     theme(axis.text.y = element_blank() , axis.ticks.y = element_blank() ,
                                           axis.title.y = element_blank() , axis.title.x = element_blank() ,  
                                           axis.line.y = element_blank()) + theme(panel.grid.major.y = element_blank() ,
                                                                                  axis.title.y = element_blank()) +
                                     ggtitle(paste0("Percent Cover by Functional Group: " , 
                                                    Species_plots_ecosite_attributed$GrowthHabitSub,
                                                    toString(EcologicalSiteId), sep = " ")) +
                                     coord_flip() + facet_grid(cols = vars(GrowthHabitSub) ,
                                                               rows = vars(Duration) ,
                                                               switch = "y" ,
                                                               scales = "free" , drop = TRUE)
                                   
                                   return(current_plot)
                                 }
                  )
}

if(!Interactive){
   Plots <- lapply(X = split(Species_plots_ecosite_attributed, Species_plots_ecosite_attributed[["GrowthHabitSub"]] , drop = TRUE), 
                             FUN = function(Species_plots_ecosite_attributed){
                             
                                 current_plot <- ggplot2::ggplot(Species_plots_ecosite_attributed , aes(x = GrowthHabitSub , y = AH_SpeciesCover)) +
                                 geom_boxplot(width = .6 , outlier.shape = NA) +
                                 geom_jitter(width = .2 , size = 2, aes(color = UQ(attribute_title), shape = Noxious)) +
                                 scale_color_manual(values = Attribute_Fill, na.value="#000000") +
                                 labs(y = "Percent Cover", 
                                 caption = paste("Percent cover in: ", toString(EcologicalSiteId))) +
                                 scale_y_continuous(limits = c(0 , 100))  +
                                 theme_light() + 
                                 theme(axis.text.y = element_blank() , axis.ticks.y = element_blank() ,
                                       axis.line.y = element_blank()) + theme(panel.grid.major.y = element_blank() ,
                                                                              axis.title.y = element_blank()) +
                                 ggtitle(paste("Percent Cover by Functional Group:", 
                                               Species_plots_ecosite_attributed$GrowthHabitSub,
                                               toString(EcologicalSiteId), sep = " ")) +
                                 coord_flip() + facet_grid(cols = vars(GrowthHabitSub) ,
                                                           rows = vars(Duration) , switch = "y" ,
                                                           scales = "free" , drop = TRUE)
                               
    
                               return(current_plot)
                             })
}
}

if(SummaryVar == "Noxious"){
  if(Interactive){
     Plots <- Species_plots_ecosite_attributed %>% group_by(Noxious) %>% 
     filter(!is.na(Noxious)) %>% filter(!is.na(AH_SpeciesCover)) %>%
     ggplot2::ggplot((aes(x = Noxious , y = AH_SpeciesCover , 
                                             text = paste("Primary Key : " , PrimaryKey, 
                                                    "Plot ID: " , PlotID , 
                                                    "Species: " ,  ScientificName, 
                                                    "Code: " , Species, 
                                                    "Percent Cover: " , AH_SpeciesCover, 
                                                    "Noxious: " , Noxious , 
                                                    "Allotment: ", UQ(attribute_title), 
                                                     sep = "<br>")))) +
           geom_boxplot(width = .6 , outlier.shape = NA) +
           geom_jitter(width = .15 , size = 2 , shape = 21) +
           theme_light() +
           scale_y_continuous(limits = c(0 , 100)) +
           labs(y = "Percent Cover") + 
           ggtitle(paste("Percent Cover, Noxious vs. Non-Noxious Species: " , 
                         toString(EcologicalSiteId))) +
            theme(axis.title.y = element_blank() , axis.text.y = element_blank() ,
                  axis.ticks.y = element_blank() , axis.line.y = element_blank() , 
                  axis.title.x = element_blank()) +
           theme(panel.grid.major.y = element_blank() , legend.position = "none") +
           coord_flip() + 
           facet_grid(rows = vars(Noxious) , switch = "y" , scales = "free" , 
                      drop = TRUE) 
           return(Plots)
  }
  
   if(!Interactive){
     Plots <- Species_plots_ecosite_attributed %>% group_by(Noxious) %>% 
       filter(!is.na(Noxious)) %>% filter(!is.na(AH_SpeciesCover)) %>%
               ggplot2::ggplot((aes(x = Noxious , y = AH_SpeciesCover))) +
               geom_boxplot(width = .6 , outlier.shape = NA) +
               geom_jitter(width = .15 , size = 2 , aes(color = UQ(attribute_title), shape = Noxious)) +
               scale_color_manual(values = Attribute_Fill, na.value="#000000") +
               theme_light() +
               scale_y_continuous(limits = c(0 , 100)) +
               labs(y = "Percent Cover") + 
               ggtitle(paste("Percent Cover, Noxious vs. Non-Noxious Species: " , 
                             toString(EcologicalSiteId))) +
                 theme(axis.title.y = element_blank() , axis.text.y = element_blank() , 
                       axis.ticks.y = element_blank() ,
                       axis.line.y = element_blank() , 
                       panel.grid.major.y = element_blank()) +
                 coord_flip() + 
                facet_grid(rows = vars(Noxious) ,
                           switch = "y" , scales = "free" , drop = TRUE)
    
   }}

if(SummaryVar == "Species"){
  PercentCover <- Species_plots_ecosite_attributed %>% subset(AH_SpeciesCover > 0.000000)
  if(Interactive){
  Plots <-lapply(X = split(PercentCover, list(PercentCover$GrowthHabitSub , PercentCover$Duration) , drop = TRUE),
                                     FUN = function(PercentCover){
                                       current_plot <- ggplot2::ggplot(PercentCover , aes(x = Species , y = AH_SpeciesCover,
                                                                                             text = paste("PrimaryKey: ", PrimaryKey , 
                                                                                                          "Plot ID: " , PlotID , "Species: " , 
                                                                                                          ScientificName , "Code: " , Species , 
                                                                                                          "Percent Cover: " , AH_SpeciesCover , "Noxious: " , 
                                                                                                          Noxious , 
                                                                                                          "Allotment: ", UQ(attribute_title), 
                                                                                                           sep = "<br>"))) +
                                         geom_boxplot(width = .6 , outlier.shape = NA) +
                                         geom_jitter(width = .15 , size = 1, shape = 21) +
                                         scale_y_continuous(limits = c(0 , 100)) +
                                         theme_light() +
                                         labs(y = "Percent Cover") + 
                                         ggtitle(paste("Percent Cover by Species, " , 
                                                       PercentCover$GrowthHabitSub, 
                                                       PercentCover$Duration ,
                                                       toString(EcologicalSiteId))) + 
                                         theme(axis.title.y = element_blank() ,
                                               axis.text.y = element_blank(),
                                               axis.ticks.y = element_blank(), 
                                               axis.title.x = element_blank())+   
                                         theme(panel.grid.major.y = element_blank() ,
                                               axis.title.y = element_blank()) +
                                         coord_flip() +  facet_grid(rows = vars(Species), 
                                                                    scales = "free" , switch = "y",  drop = TRUE) 
                                       return(current_plot)
                                     })
  }
  
  if(!Interactive){
    Plots <- lapply(X = split(PercentCover, list(PercentCover$GrowthHabitSub , 
                                                                            PercentCover$Duration) , 
                                             drop = TRUE),
                                   FUN = function(PercentCover){
                                     current_plot <- ggplot2::ggplot(PercentCover , aes(x = Species , y = AH_SpeciesCover)) +
                                       geom_boxplot(width = .6 , outlier.shape = NA) +
                                       geom_jitter(width = .15 , size = 1 , aes(color = UQ(attribute_title), shape = Noxious)) +
                                       scale_color_manual(values = Attribute_Fill, na.value="#000000") + 
                                       scale_y_continuous(limits = c(0 , 100)) +
                                       theme_light() +
                                       labs(y = "Percent Cover") + 
                                       ggtitle(paste("Percent Cover by Species, " , 
                                                     PercentCover$GrowthHabitSub , 
                                                     PercentCover$Duration , 
                                                     toString(EcologicalSiteId))) + 
                                       theme(axis.title.y = element_blank()) +
                                       coord_flip() +  facet_grid(cols = vars(GrowthHabitSub) , rows = vars(Duration) ,
                                                                  switch = "y" , scales = "free" , drop = TRUE) 
                                     return(current_plot)
                                   })
    
}
}

if(SummaryVar == "GroundCover"){
  
  #Prep
    #BareSoilCover
    #TotalFoliarCover
    #FH_TotalLitterCover
    #FH_RockCover
    
    Ground_Cover_Tall <- EcoSitePlots_Attributed %>% 
                        dplyr::select(PlotID, PrimaryKey, BareSoilCover , 
                                      TotalFoliarCover , FH_TotalLitterCover , 
                                      FH_RockCover, UQ(attribute_title), ALLOT_NO) %>%
                        gather(key = Indicator , value = Percent, 
                               BareSoilCover:FH_RockCover) %>% mutate(Tally = 1) 
    if(Interactive){
    
    Plots <- Ground_Cover_Tall %>% mutate_if(is.numeric , round , digits = 2) %>% 
              ggplot2::ggplot((aes(x = Indicator , y = Percent , 
                           text = paste("PlotID: " , PlotID , 
                           "PrimaryKey: " , PrimaryKey , 
                           "Indicator: " , Indicator ,
                           "Percent Cover: " , Percent , 
                           "Attribute: ", UQ(attribute_title), 
                            sep = "<br>" )))) +
               geom_boxplot(width = .6 , outlier.shape = NA) +
               geom_jitter(width = .15 , shape = 21) +
               theme_light() +
               scale_y_continuous(limits = c(0 , 100)) +
               labs(y = "Ground Cover (%)" , x = "Indicator") +
               theme(axis.text.y = element_blank() , 
                     axis.ticks.y = element_blank() ,
                     axis.line.y = element_blank() ,  
                     axis.title.x = element_blank() , 
                     axis.title.y = element_blank()) +
              coord_flip() + facet_grid(rows = vars(Indicator) ,
                                switch = "y" ,
                                scales = "free_y" , drop = TRUE)
    
    }
    
    if(!Interactive){
       Plots <- Ground_Cover_Tall %>% mutate_if(is.numeric , round , digits = 2) %>% 
                   ggplot2::ggplot((aes(x = Indicator , y = Percent))) +
                   geom_boxplot(width = .6 , outlier.shape = NA) +
                   geom_jitter(width = .15, aes(color = UQ(attribute_title))) +
                   theme_light() +
                   scale_color_manual(values = Attribute_Fill, na.value="#000000") +
                   scale_y_continuous(limits = c(0 , 100)) +
                   labs(y = "Ground Cover (%)" , x = "Indicator") +
                   theme(axis.text.y = element_blank() , 
                         axis.ticks.y = element_blank() ,
                         axis.line.y = element_blank()) + 
                   coord_flip() + facet_grid(rows = vars(Indicator) ,
                                  switch = "y" ,
                                  scales = "free_y" , drop = TRUE)
      
       
    }
  
  
}

if(SummaryVar == "Gap"){
  
  Gap <- EcoSitePlots_Attributed %>% dplyr::select(PlotID , PrimaryKey , 
                                        GapCover_25_50 , GapCover_51_100 , 
                                        GapCover_101_200 , GapCover_200_plus , 
                                        GapCover_25_plus, UQ(attribute_title)) %>% 
                                gather(key = Gap_Class_cm , 
                                value = Percent , GapCover_25_50:GapCover_25_plus) %>%
                                mutate_if(is.numeric , round, digits = 2)
  
  #Plot prep
  if(Interactive){
 
     Plots <- ggplot2::ggplot(data = Gap , aes(x = Gap_Class_cm , y = Percent , 
                                      text = paste("PlotID: " , PlotID , 
                                            "PrimaryKey: ", PrimaryKey , 
                                            "Gap Class (cm): " , Gap_Class_cm, 
                                            "Percent Cover: " , Percent , 
                                             "Attribute: ", UQ(attribute_title), 
                                             sep = "<br>"))) +
                       geom_boxplot() + coord_flip() + 
                       geom_jitter(width = 0.1 , shape = 21) +
                       theme_light() + 
                       theme(axis.title.x = element_blank() ,
                          axis.text.y = element_blank() , 
                          axis.ticks.y = element_blank() , 
                          axis.title.y = element_blank() , 
                          axis.line.y = element_blank(), 
                          panel.grid.major.y = element_blank()) +
                      facet_grid(rows = vars(Gap_Class_cm) , switch = "y" ,
                      scales = "free_y" , drop = TRUE)
  
  }
  
  if(!Interactive){
      Plots <- ggplot2::ggplot(data = Gap , aes(x = Gap_Class_cm , y = Percent)) +
               labs(y = "Percent Cover" , x = "Gap Size Class (cm)", 
                    caption = paste("Percent cover of canopy gap in: ", 
                                    toString(EcologicalSiteId))) +
                    geom_boxplot() + 
                    coord_flip() + 
                    geom_jitter(width = 0.1, aes(color = UQ(attribute_title))) +
                    theme_light() + 
                    scale_color_manual(values = Attribute_Fill, na.value="#000000") + 
                    theme(axis.text.y = element_blank() , 
                          axis.ticks.y = element_blank() ,
                          axis.line.y = element_blank(),
                          panel.grid.major.y = element_blank()) +
                   facet_grid(rows = vars(Gap_Class_cm) , switch = "y" ,
                   scales = "free_y" , drop = TRUE)
  }
  
}

if(SummaryVar == "SoilStability"){
  
  soil_labels <- c("SoilStability_All" = "All" , "SoilStability_Protected" = "Protected" , 
                   "SoilStability_Unprotected" = "Unprotected")
  
  SoilStability <- EcoSitePlots_Attributed %>% dplyr::select(PlotID , PrimaryKey , 
                                                           SoilStability_All , 
                                             SoilStability_Protected , 
                                             SoilStability_Unprotected,
                                             UQ(attribute_title), 
                                             ALLOT_NO) %>%
                          gather(key = Veg , value = Rating , 
                          SoilStability_All:SoilStability_Unprotected) %>%
                          mutate_if(is.numeric, round, digits = 2) 
    
  if(Interactive){

    Plots <- ggplot2::ggplot(data = SoilStability , 
                    aes(x = Veg , y = Rating , 
                        text = paste("Primary Key: " , PrimaryKey,
                        "Plot ID: " , PlotID , 
                        "Rating: " , Rating , 
                        "Attribute: ", UQ(attribute_title), 
                        sep = "<br>"))) +
                        geom_boxplot() + 
                        coord_flip() + 
                        geom_jitter(width = 0.1 , shape = 21) +
                        theme_light() + 
                        theme(axis.text.y = element_blank() , 
                             axis.ticks.y = element_blank() ,
                             axis.line.y = element_blank(),
                             panel.grid.major.y = element_blank(),
                             axis.title = element_blank()) +
                       facet_grid(rows = vars(Veg) , switch = "y" ,
                       scales = "free_y" , drop = TRUE , 
                       labeller = as_labeller(soil_labels))
  }
  
  
  if(!Interactive){
    
            Plots <- ggplot2::ggplot(data = SoilStability , 
                            aes(x = Veg , y = Rating)) +
                     labs(x = "Vegetation cover class" , 
                          y = "Soil Stability Rating",
                          caption = paste("Soil stability ratings in: ", 
                                          toString(EcologicalSiteId))) +
                          geom_boxplot() + coord_flip() + geom_jitter(width = 0.1, aes(color = UQ(attribute_title))) +
                          theme_light() + 
                          scale_color_manual(values = Attribute_Fill, na.value="#000000") + 
                          theme(axis.text.y = element_blank() , 
                          axis.ticks.y = element_blank() ,
                          axis.line.y = element_blank(), 
                          panel.grid.major.y = element_blank()) +
                          facet_grid(rows = vars(Veg) , 
                                     switch = "y" ,
                                     scales = "free_y" , 
                                     drop = TRUE , 
                                     labeller = as_labeller(soil_labels))
    
  }

}

return(Plots)
  
}
```

```{r SFG plots grass , fig.height = 5 , fig.width = 10 , echo = FALSE, include = FALSE}

SFG_Plots_Interactive <- local(SummaryFigures_WithAttributes_alt(SpeciesList = SpeciesList, 
                                                       Species_plots_ecosite = Species_plots_ecosite,
                                                       EcologicalSiteId = EcologicalSiteId,  
                                                       SummaryVar = "GrowthHabitSub", 
                                                       Interactive = TRUE,
                                                       Attributed_Pks = Attributed_Pks,
                                                       EcoSitePlots = EcoSitePlots))

plotly::ggplotly(SFG_Plots_Interactive[["Graminoid"]])

```

##### Static 
```{r SFG plots grass static, fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

SFG_Plots_Static <- SummaryFigures_WithAttributes_alt(SpeciesList, Species_plots_ecosite,  
                                               EcologicalSiteId,  
                                               SummaryVar = "GrowthHabitSub", 
                                               Interactive = FALSE, 
                                               Attributed_Pks = Attributed_Pks,
                                               EcoSitePlots = EcoSitePlots)

SFG_Plots_Static[["Graminoid"]]
```


#### Forb {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

```{r SFG plots forb , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

plotly::ggplotly(SFG_Plots_Interactive[["Forb"]] , tooltip = "text")

```

##### Static 

```{r SFG plots forb static, fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

SFG_Plots_Static[["Forb"]] 

```

#### Sub Shrub {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r SFG plots subshrub , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

plotly::ggplotly(SFG_Plots_Interactive[["SubShrub"]] , tooltip = "text")

```

##### Static 

```{r SFG plots subshrub static, fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

SFG_Plots_Static[["SubShrub"]]

```

####  Shrub {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r SFG plots shrub , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

plotly::ggplotly(SFG_Plots_Interactive[["Shrub"]] , tooltip = "text")

```

##### Static 

```{r SFG plots shrub static, fig.height = 5 , fig.width = 10 , echo = FALSE, include = FALSE}

SFG_Plots_Static[["Shrub"]]

```

####  Tree {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r SFG plots tree , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

plotly::ggplotly(SFG_Plots_Interactive[["Tree"]] , tooltip = "text")

```

##### Static 

```{r SFG plots tree static , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

SFG_Plots_Static[["Tree"]]

```

####  Succulent {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r SFG plots succulent , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

plotly::ggplotly(SFG_Plots_Interactive[["Succulent"]] , tooltip = "text")

```

##### Static

```{r SFG plots succulent static , fig.height = 5 , fig.width = 10 , echo = FALSE, include = TRUE}

SFG_Plots_Static[["Succulent"]]

```

### Cover by Noxious, Non-Noxious Species {.tabset .tabset-fade .tabset-pills}
####
#### Interactive 

```{r nox plots , fig.height = 4 , fig.width = 10 , echo = FALSE, include = TRUE}

plotly::ggplotly(SummaryFigures_WithAttributes_alt(SpeciesList, Species_plots_ecosite,
                                               EcologicalSiteId,
                                               SummaryVar = "Noxious",
                                               Interactive = TRUE,
                                               Attributed_Pks = Attributed_Pks,
                                               EcoSitePlots = EcoSitePlots))


```

#### Static

```{r nox plots static , fig.height = 4 , fig.width = 10 , echo = FALSE, include = TRUE}

SummaryFigures_WithAttributes_alt(SpeciesList, Species_plots_ecosite, EcologicalSiteId,
               SummaryVar = "Noxious", Interactive = FALSE, Attributed_Pks = Attributed_Pks, 
               EcoSitePlots = EcoSitePlots)


```

### Cover by Species {.tabset .tabset-fade .tabset-pills}

####

#### Graminoid , Annual {.tabset .tabset-fade .tabset-pills}
#####

##### Interactive 

<div class = "ScrollStyle">


```{r species plots grass annual , fig.height = 10  , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Interactive <- SummaryFigures_WithAttributes_alt(SpeciesList, Species_plots_ecosite,  
                                               EcologicalSiteId,  
                                               SummaryVar = "Species", 
                                               Interactive = TRUE,
                                               Attributed_Pks = Attributed_Pks,
                                               EcoSitePlots = EcoSitePlots)

plotly::ggplotly(Species_Plots_Interactive[["Graminoid.Annual"]] , tooltip = "text")

```

</div>

##### Static 

<div class = "ScrollStyle">


```{r species plots grass annual static , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}


Species_Plots_Static <- SummaryFigures_WithAttributes_alt(SpeciesList, Species_plots_ecosite,  
                                               EcologicalSiteId,  
                                               SummaryVar = "Species", 
                                               Interactive = FALSE,
                                               Attributed_Pks = Attributed_Pks,
                                               EcoSitePlots = EcoSitePlots)
Species_Plots_Static[["Graminoid.Annual"]]

```

</div>

#### Graminoid , Perennial {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

<div class = "ScrollStyle">

```{r species plots grass perennial, fig.height = 14 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["Graminoid.Perennial"]] , tooltip = "text")

```

</div>

##### Static

```{r species plots grass perennial static, fig.height = 14 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["Graminoid.Perennial"]]

```


#### Forb, Annual {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

<div class = "ScrollStyle">

```{r species plots forb annual , fig.height = 18 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["Forb.Annual"]] , tooltip = "text")

```

</div>

##### Static 


```{r species plots forb annual static , fig.height = 14 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["Forb.Annual"]]

```


#### Forb, Perennial {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

<div class = "ScrollStyle">

```{r species plots forb perennial , fig.height = 18 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["Forb.Perennial"]] , tooltip = "text")

```

</div>

##### Static 


```{r species plots forb perennial static, fig.height = 14 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["Forb.Perennial"]]

```


#### Sub Shrub {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

<div class = "ScrollStyle">


```{r species plots subshrub , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["SubShrub.Perennial"]] , tooltip = "text")

```

</div>

##### Static 

<div class = "ScrollStyle">


```{r species plots subshrub static, fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["SubShrub.Perennial"]]

```

</div>

#### Shrub {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 
<div class = "ScrollStyle">

```{r species plots shrub , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["Shrub.Perennial"]] , tooltip = "text")

```

</div>


##### Static 
<div class = "ScrollStyle">

```{r species plots shrub static , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["Shrub.Perennial"]]

```

</div>

#### Tree {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

<div class = "ScrollStyle">

```{r species plots tree , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["Tree.Perennial"]] , tooltip = "text")

```

</div>

##### Static 

<div class = "ScrollStyle">

```{r species plots tree static, fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["Tree.Perennial"]]

```

</div>

#### Succulent {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

<div class = "ScrollStyle">
```{r species plots succulent , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(Species_Plots_Interactive[["Succulent.Perennial"]] , tooltip = "text")

```

</div>

##### Static 

<div class = "ScrollStyle">
```{r species plots succulent static , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

Species_Plots_Static[["Succulent.Perennial"]]

```
</div>


### Sage-Grouse Indicators {.tabset .tabset-fade .tabset-pills}

#### By Sage-Grouse Group  {.tabset .tabset-fade .tabset-pills}

#####
##### Interactive

*Note that sage-grouse groups may not be attributed for every state. Consult with your project lead before using these values in reporting.*

<div class = "ScrollStyle">

```{r sggroup interactive , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}


plotly::ggplotly(SageGrouseSummaries_WithAttributes_alt(EcoSitePlots, Species_plots_ecosite,
                              SummaryVar = "SageGrouseGroup",
                              Interactive = TRUE, Attributed_Pks = Attributed_Pks), tooltip = "text")


```
</div>

##### Static

*Note that these groups may not be attributed for every state. Consult with your project lead before using these values in reporting.*


<div class = "ScrollStyle">

```{r sggroup static , fig.height = 10 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

SageGrouseSummaries_WithAttributes_alt(EcoSitePlots, Species_plots_ecosite,
                    SummaryVar = "SageGrouseGroup", Interactive = FALSE, Attributed_Pks = Attributed_Pks)

```

</div>


#### Preferred Forbs  {.tabset .tabset-fade .tabset-pills}

#####
##### Interactive

<div class = "ScrollStyle">

```{r pref forb interactive , fig.height = 18 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(SageGrouseSummaries_WithAttributes(EcoSitePlots, Species_plots_ecosite,
                    SummaryVar = "PreferredForb", Interactive = TRUE, Attributed_Pks = Attributed_Pks), tooltip = "text")

```
</div>

##### Static

<div class = "ScrollStyle">
```{r pref forb static, fig.height = 14 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

SageGrouseSummaries_WithAttributes(EcoSitePlots, Species_plots_ecosite,
                    SummaryVar = "PreferredForb", Interactive = FALSE, Attributed_Pks = Attributed_Pks)

```

</div>

#### Sagebrush  {.tabset .tabset-fade .tabset-pills}

#####
##### Interactive

<div class = "ScrollStyle">

```{r sagebrush interactive , fig.height = 6 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

plotly::ggplotly(SageGrouseSummaries_WithAttributes(EcoSitePlots, Species_plots_ecosite, 
                    SummaryVar = "Sagebrush", Interactive = TRUE, Attributed_Pks = Attributed_Pks), tooltip = "text")

```
</div>

##### Static

<div class = "ScrollStyle">

```{r pref sagebrush static, fig.height = 6 , fig.width = 10 , echo = FALSE, include = TRUE , results = 'asis'}

SageGrouseSummaries_WithAttributes(EcoSitePlots, Species_plots_ecosite, 
                    SummaryVar = "Sagebrush", Interactive = FALSE, Attributed_Pks = Attributed_Pks)

```

</div>

## Summary Tables {.tabset .tabset-fade .tabset-pills}

Foliar cover values are summarized in tables below. Tables summarize data across the ecological site as well as by plot within the ecological site. *Note that percent cover on a per-plot basis is not cumulative because we are calculating cover from any hit on line point intercept. Percent cover values per plot could therefore potentially add up to over 100. See Ground Cover Summary Table for total foliar cover estimates.* Per plot measurements are intended to allow you to compare plot level data to the status of the ecological site as a whole. 

###

### Percent Cover by Species {.tabset .tabset-fade .tabset-pills}
####
#### By Plot

Percent cover by species by plot within your specified ecological site. 

```{r plots, echo = FALSE , resutls = 'asis' , fig.height = 8}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Species", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)
```

#### Ecological Site 

Percent cover by species averaged across the ecological site.

```{r species, echo = FALSE , resutls = 'asis' , fig.height = 8}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Species", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)

```

### Percent Cover by Structure and Functional Group {.tabset .tabset-fade .tabset-pills}

####

#### By Plot

Average percent cover by structure and functional group across your specified ecological site. 

```{r SFG by plot , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "GrowthHabitSub", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks) 

```

#### Ecological Site 

Average percent cover by structure and functional group across your specified ecological site. 

```{r SFG , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "GrowthHabitSub", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)
                       
```

### Percent Cover, Noxious vs. Non-Noxious Species{.tabset .tabset-fade .tabset-pills}

####
#### By Plot

Percent cover by noxious versus non-noxious plants by plot within your specified ecological site. 

```{r noxious by plot , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Noxious", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)

```

#### Ecological Site

Percent cover by noxious versus non-noxious plants averaged across your specified ecological site. 

```{r noxious , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Noxious", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)

```

### Percent Cover, Woody vs. Non-Woody {.tabset .tabset-fade .tabset-pills}

####
#### By Plot

```{r woody by plot , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Woody", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)

```

#### Ecological Site

Percent cover by woody versus herbaceous plants averaged across your specified ecological site.  

```{r woody , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Woody", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)

```

### Percent Cover by Sage-Grouse Group {.tabset .tabset-fade .tabset-pills}

####

#### By Plot

*Note that these groups may not be attributed in every state. Consult with your project lead before using these values in reporting*


Percent cover by Sage-Grouse group by plot within your specified ecological site. 

```{r Sage-Grouse by Plot, echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "SageGrouseGroup", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)
                       
```

#### Ecological Site

*Note that these groups may not be attributed in every state. Consult with your project lead before using these values in reporting*

Percent cover by Sage-Grouse group averaged across your specified ecological site. 

```{r Sage Grouse , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "SageGrouseGroup", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)
                       
```


### Percent Cover, Preferred Forbs {.tabset .tabset-fade .tabset-pills}

####
#### By Plot

```{r Sage Grouse PrefForb by Plot, echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "PreferredForb", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks) 
                       
```

#### Ecological Site

Percent cover by preferred forbs averaged across your specified ecological site.

```{r Sage-Grouse PrefForb, echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "PreferredForb", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks) 
                       
```

## Trace Species {.tabset .tabset-fade .tabset-pills}

It is unlikely that all species on a plot will be detected in line point intercept. It can be inferred that these species that were never detected in LPI have "low abundance" across this ecological site. To determine all species detected on plots throughout an ecological site (or other grouping feature), we can pull in all species detected from all other methods using the accumulated species indicator. This can give us an idea of overall diversity across the ecological site, indicate seed bank and restoration potential, and inform us more about community composition and species trends as plots are repeatedly surveyed.

###

### By Plot

This table contains species that were only ever detected in species richness inventory on a per plot basis within the ecological site. 

```{r trace species table by plot  , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "TraceSpecies", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks) 

```

### Ecological Site

This table contains species that were only ever detected in species richness inventory across the entire ecological site. 

```{r trace species table , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "TraceSpecies", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks) 

```


# 5. Ground Cover Summaries {.tabset .tabset-fade .tabset-pills}

In addition to species-specific indicators, we can summarize ground cover indicators to get percent cover values for bare ground, total rock, total litter, and total foliar. Additional indicators that can be included here are Lichen ("LC") , Moss ("M") , Duff ("D"), and/or Cyanobacteria ("CY"). These calculations are informative for assessing the status of the ecological site as a whole, susceptibility to erosion, and/or cross-walking AIM data to [Rangeland Health Assessments](https://www.landscapetoolbox.org/manuals/iirhv5/) when used in conjunction with species specific calculations.

##
## Figures {.tabset .tabset-fade .tabset-pills}

###
### Interactive  

```{r LPI ground plot , echo = FALSE , fig.height = 6 , fig.width = 10 , results = 'asis'}

plotly::ggplotly(SummaryFigures_WithAttributes(SpeciesList, Species_plots_ecosite,  
                        EcologicalSiteId, SummaryVar = "GroundCover", 
                        Interactive = TRUE, Attributed_Pks = Attributed_Pks,
                        EcoSitePlots = EcoSitePlots))

```

### Static 

```{r LPI ground plot static , echo = FALSE ,  fig.height = 6 , fig.width = 10 ,  results = 'asis'}

SummaryFigures_WithAttributes(SpeciesList, Species_plots_ecosite,  
                        EcologicalSiteId, SummaryVar = "GroundCover", 
                        Interactive = FALSE, Attributed_Pks = Attributed_Pks,
                        EcoSitePlots = EcoSitePlots)

```


## Summary Tables {.tabset .tabset-fade .tabset-pills}

###
### By Plot

Ground cover indicator values by plot within the specified ecological site.

```{r LPI ground cover table plot, echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "GroundCover", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)

```

### Ecological Site

Ground cover values averaged across the specified ecological site.
 
```{r LPI ground cover table , echo = FALSE , results = 'asis'}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "GroundCover", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)

```

# 6. Vegetation Heights {.tabset .tabset-fade .tabset-pills}

Looking at height data in conjunction with canopy gap data helps inform the vegetation structure across a site.

##
## Heights Figures  {.tabset .tabset-fade .tabset-pills}

### 
### By Functional Group {.tabset .tabset-fade .tabset-pills}

####
#### Interactive 

```{r heights plot , fig.height = 10 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(SummaryFigures_Height_WithAttributes(Species_plots_ecosite, 
                 EcologicalSiteId, SummaryVar = "Height", GroupBy = "GrowthHabit", 
                 Interactive = TRUE, Attributed_Pks = Attributed_Pks), tooltip = "text")

```

#### Static 

```{r heights plot static , fig.height = 10 , fig.width = 10 , echo = FALSE , include = TRUE}

SummaryFigures_Height(Species_plots_ecosite, EcologicalSiteId,
                      SummaryVar = "Height", GroupBy = "GrowthHabit", 
                      Interactive = FALSE)

```

### By Species  {.tabset .tabset-fade .tabset-pills}
####

#### Graminoid , Annual {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r heights plot grass , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_interactive <- SummaryFigures_Height_WithAttributes(Species_plots_ecosite, 
                                                    EcologicalSiteId,
                                                    SummaryVar = "Height", 
                                                    GroupBy = "Species", 
                                                    Interactive = TRUE,
                                                    Attributed_Pks = Attributed_Pks)
plotly::ggplotly((Height_species_interactive[["Graminoid.Annual"]]), tooltip = "text")

```

##### Static 

```{r heights plot grass static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static <- SummaryFigures_Height_WithAttributes(Species_plots_ecosite, 
                                                    EcologicalSiteId,
                                                    SummaryVar = "Height", 
                                                    GroupBy = "Species", 
                                                    Interactive = FALSE,
                                                    Attributed_Pks = Attributed_Pks)

Height_species_static[["Graminoid.Annual"]]

```

#### Graminoid , Perennial {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

```{r heights plot grass p, fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["Graminoid.Perennial"]] , tooltip = "text")

```

##### Static

```{r heights plot grass p static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["Graminoid.Perennial"]]

```

#### Forb , Annual {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

```{r heights plot forb , fig.height = 5 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["Forb.Annual"]] , tooltip = "text")

```

##### Static 

```{r heights plot forb static , fig.height = 8 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["Forb.Annual"]]

```

#### Forb , Perennial {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r heights plot forb p , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["Forb.Perennial"]] , tooltip = "text")

```

##### Static

```{r heights plot forb p static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["Forb.Perennial"]]

```

#### SubShrub {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r heights plot subshrub , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["SubShrub.Perennial"]] , tooltip = "text")

```

##### Static

```{r heights plot subshrub static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["SubShrub.Perennial"]]

```

#### Shrub {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

```{r heights plot shrub , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["Shrub.Perennial"]] , tooltip = "text")

```

##### Static 

```{r heights plot shrub static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["Shrub.Perennial"]]

```

#### Tree {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive

```{r heights plot tree , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["Tree.Perennial"]] , tooltip = "text")

```

##### Static

```{r heights plot tree static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["Tree.Perennial"]]

```

#### Succulent {.tabset .tabset-fade .tabset-pills}
#####
##### Interactive 

```{r heights plot succ , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(Height_species_interactive[["Succulent.Perennial"]] , tooltip = "text")

```

##### Static 

```{r heights plot succ static , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

Height_species_static[["Succulent.Perennial"]]

```

### Sagebrush {.tabset .tabset-fade .tabset-pills}

#### 
#### Interactive

```{r heights plot sagebrush , fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

plotly::ggplotly(SummaryFigures_Height(Species_plots_ecosite, EcologicalSiteId,
                      SummaryVar = "Height", GroupBy = "Sagebrush", 
                      Interactive = TRUE), tooltip = "text")
```

#### Static

```{r heights plot sagebrush static, fig.height = 6 , fig.width = 10 , echo = FALSE , include = TRUE}

SummaryFigures_Height_WithAttributes(Species_plots_ecosite, EcologicalSiteId,
                      SummaryVar = "Height", GroupBy = "Sagebrush", 
                      Interactive = FALSE, Attributed_Pks = Attributed_Pks)

```


## Heights Summary Tables {.tabset .tabset-fade .tabset-pills}
###

### Functional Group {.tabset .tabset-fade .tabset-pills}

####
#### By Plot

```{r heights table plot, echo = FALSE , include = TRUE}

SummaryTables_Height_WithAttributes(Species_plots_ecosite, SummaryVar = "Height", 
                     SummarizeBy = "Plot", GroupBy = "GrowthHabit", Attributed_Pks = Attributed_Pks)

```


#### Ecological Site

```{r heights table , echo = FALSE , include = TRUE}

SummaryTables_Height_WithAttributes(Species_plots_ecosite, SummaryVar = "Height", 
                     SummarizeBy = "EcologicalSite", GroupBy = "GrowthHabit", 
                     Attributed_Pks = Attributed_Pks)

```

### Species {.tabset .tabset-fade .tabset-pills}

####

#### By Plot

```{r heights table plot , echo = FALSE , include = TRUE}

SummaryTables_Height_WithAttributes(Species_plots_ecosite, SummaryVar = "Height", 
                     SummarizeBy = "Plot", GroupBy = "Species", Attributed_Pks = Attributed_Pks)

```

#### Ecological Site

```{r heights table species, echo = FALSE , include = TRUE}

SummaryTables_Height_WithAttributes(Species_plots_ecosite, SummaryVar = "Height", 
                     SummarizeBy = "EcologicalSite", GroupBy = "Species",
                     Attributed_Pks = Attributed_Pks)

```

### Sagebrush {.tabset .tabset-fade .tabset-pills}

####
#### By Plot

```{r heights table sagebrush plot, echo = FALSE , include = TRUE}

SummaryTables_Height_WithAttributes(Species_plots_ecosite, SummaryVar = "Height", 
                     SummarizeBy = "Plot", GroupBy = "Sagebrush", Attributed_Pks = Attributed_Pks)

```


#### Ecological Site

```{r heights table sagebrush site, echo = FALSE , include = TRUE}

SummaryTables_Height_WithAttributes(Species_plots_ecosite, SummaryVar = "Height", 
                     SummarizeBy = "EcologicalSite", GroupBy = "Sagebrush",
                     Attributed_Pks = Attributed_Pks)

```

# 7. Canopy Gap  {.tabset .tabset-fade .tabset-pills}

Canopy gap intercept can inform us about potential wind erosion, weed invasion, and wildlife habitat. When combined with vegetation height measurements, gap measurements can inform us about vegetation structure (see p. 41 in the [Monitoring Manual](https://www.landscapetoolbox.org/wp-content/uploads/2016/02/MMGSSE_20170614.pdf) for methods). Canopy gap, bare soil, and vegetation heights c
an also be used to determine thresholds at which vegetation structure may lead to a shift in ecological states.

##
## Canopy Gap Size Class Figure  {.tabset .tabset-fade .tabset-pills}
###
### Interactive

```{r Gap plot , echo = FALSE , include = TRUE , fig.height = 10 , fig.width= 8}

plotly::ggplotly(SummaryFigures_WithAttributes(SpeciesList, Species_plots_ecosite,  
                        EcologicalSiteId,  SummaryVar = "Gap", 
                        Interactive = TRUE, Attributed_Pks = Attributed_Pks,
                        EcoSitePlots = EcoSitePlots), tooltip = "text") 

```

### Static

```{r Gap plot static , echo = FALSE , include = TRUE , fig.height = 7 , fig.width= 8}

SummaryFigures_WithAttributes(SpeciesList, Species_plots_ecosite,  
               EcologicalSiteId, SummaryVar = "Gap", 
               Interactive = FALSE,
               Attributed_Pks = Attributed_Pks,
               EcoSitePlots = EcoSitePlots)

```

## Canopy Gap Size Class Summary Table {.tabset .tabset-fade .tabset-pills}

###
### By Plot

The table below shows gap size classes represented within each plot within the specified ecological site. 

```{r Gap plot summary , echo = FALSE , include = TRUE}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Gap", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)

```

### Ecological Site

Below is a summary of average percent cover within each gap size class across the specified ecological site.

```{r Gap summary , echo = FALSE , include = TRUE}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "Gap", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)
  
```

# 8. Soil Stability  {.tabset .tabset-fade .tabset-pills}

Soil stability provides information on soil structure development and resistance to erosion. The soil stability test measures the soil's stability when exposed to rapid wetting, and reflects soil biotic integrity (see page 47 in the [Monitoring Manual](https://www.landscapetoolbox.org/wp-content/uploads/2016/02/MMGSSE_20170614.pdf).)

##
## Soil Stability Summary Figure {.tabset .tabset-fade .tabset-pills}

###
### Interactive
```{r soil stab plot , echo = FALSE , include = TRUE , fig.height = 8 , fig.width = 10}

plotly::ggplotly(SummaryFigures_WithAttributes(SpeciesList, Species_plots_ecosite,  
         EcologicalSiteId,SummaryVar = "SoilStability", Interactive = TRUE,
         Attributed_Pks = Attributed_Pks, 
         EcoSitePlots = EcoSitePlots), 
         tooltip = "text")

```

### Static
```{r soil stab plot static , echo = FALSE , include = TRUE , fig.height = 8 , fig.width = 10}

SummaryFigures_WithAttributes(SpeciesList, Species_plots_ecosite,  
         EcologicalSiteId,SummaryVar = "SoilStability", Interactive = FALSE,
         Attributed_Pks = Attributed_Pks, EcoSitePlots = EcoSitePlots)

```

## Soil Stability Summary Table {.tabset .tabset-fade .tabset-pills}

###
### By Plot

Below are the soil stability ratings for each individual plot within the specified ecological site. 

```{r soil stab table by plot , echo = FALSE , include = TRUE}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "SoilStability", 
              SummarizeBy = "Plot", Attributed_Pks = Attributed_Pks)

```

### Ecological Site

Below are the average soil stability ratings within the specified ecological site. 

```{r soil stab table , echo = FALSE , include = TRUE}

SummaryTables_WithAttributes(EcoSitePlots, Species_plots_ecosite, SummaryVar = "SoilStability", 
              SummarizeBy = "EcologicalSite", Attributed_Pks = Attributed_Pks)

```


